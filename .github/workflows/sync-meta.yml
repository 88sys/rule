# æ–‡ä»¶å: .github/workflows/cleanup-binary-files.yml
# è¿è¡Œä¸€æ¬¡ï¼Œç„¶åå°±å¯ä»¥åˆ é™¤è¿™ä¸ªæ–‡ä»¶

name: Cleanup Binary Files

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  cleanup:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup environment
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Remove binary .dat files
        run: |
          echo "åˆ é™¤ä¸éœ€è¦çš„äºŒè¿›åˆ¶æ–‡ä»¶..."
          
          # åˆ é™¤æ‰€æœ‰ .dat æ–‡ä»¶
          if ls meta/*.dat 1> /dev/null 2>&1; then
            echo "æ‰¾åˆ°ä»¥ä¸‹ .dat æ–‡ä»¶:"
            ls -la meta/*.dat
            
            # åˆ é™¤å®ƒä»¬
            rm -f meta/*.dat
            echo "âœ… å·²åˆ é™¤æ‰€æœ‰ .dat æ–‡ä»¶"
          else
            echo "æ²¡æœ‰æ‰¾åˆ° .dat æ–‡ä»¶"
          fi
          
          # æ˜¾ç¤ºå‰©ä½™çš„æ–‡ä»¶ç»“æ„
          echo "æ¸…ç†åçš„ meta ç›®å½•ç»“æ„:"
          ls -la meta/

      - name: Commit and push if changes
        run: |
          # æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ”¹
          git add meta
          
          if git diff --cached --quiet; then
            echo "æ²¡æœ‰æ›´æ”¹éœ€è¦æäº¤"
          else
            echo "æäº¤æ›´æ”¹..."
            git commit -m "ğŸ§¹ æ¸…ç†ï¼šåˆ é™¤ä¸éœ€è¦çš„äºŒè¿›åˆ¶æ–‡ä»¶ (.dat)"
            git push origin main
            echo "âœ… å·²æ¸…ç†å¹¶æäº¤"
          fi
